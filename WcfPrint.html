<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WCF Print Template</title>
  <style>
    @page {
      size: 8in 13in;
      margin: 0.5in;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      background: #fff;
      color: #000;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 9px;
      line-height: 1.15;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    .sheet {
      width: 7in;
      min-height: 12in;
      margin: 0 auto;
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
      table-layout: fixed;
    }

    td,
    th {
      border: 1px solid #000;
      padding: 2px 3px;
      vertical-align: middle;
      word-wrap: break-word;
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    .no-border {
      border: none !important;
    }

    .p0 {
      padding: 0 !important;
    }

    .center {
      text-align: center;
    }

    .right {
      text-align: right;
    }

    .top {
      vertical-align: top;
    }

    .bold {
      font-weight: bold;
    }

    .tiny {
      font-size: 7px;
    }

    .small {
      font-size: 8px;
    }

    .title {
      font-size: 23px;
      font-weight: bold;
      letter-spacing: 0.15px;
    }

    .subtitle {
      font-size: 10px;
      font-weight: bold;
    }

    .box-label {
      font-weight: bold;
      white-space: nowrap;
    }

    .checkbox {
      display: inline-block;
      width: 8px;
      height: 8px;
      border: 1px solid #000;
      margin-right: 4px;
      vertical-align: -1px;
      line-height: 8px;
      text-align: center;
      font-size: 7px;
      overflow: hidden;
    }

    .vertical {
      writing-mode: vertical-rl;
      transform: rotate(180deg);
      text-align: center;
      white-space: nowrap;
      font-size: 7px;
      font-weight: bold;
      padding: 3px 1px;
      line-height: 1;
    }

    .logo-box {
      height: 40px;
      min-height: 40px;
      display: block;
      padding: 4px;
      overflow: visible;
    }

    .logo-box img {
      display: block;
      border: 0;
      outline: 0;
      max-height: 32px;
      max-width: 140px;
      width: auto;
      height: auto;
      object-fit: contain;
    }
    
    .debug-border {
      outline: 2px dashed #f00 !important;
    }
    
    .debug-text {
      font-size: 6px;
      color: #333;
      background: #fff;
      padding: 1px 2px;
      margin-top: 2px;
      font-family: monospace;
      word-break: break-all;
    }

    .attach-placeholder {
      display: block;
      width: 100%;
      height: 100%;
      text-align: center;
      padding: 4px;
      overflow: hidden;
      position: relative;
      background: #fff;
      box-sizing: border-box;
      border: 1px solid #000;
    }

    .attach-placeholder img {
      display: block;
      border: 0;
      outline: 0;
      width: 100%;
      height: 100%;
      margin: 0 auto;
      object-fit: contain;
      object-position: center;
    }

    .signature-box {
      min-height: 40px;
      height: 40px;
      display: block;
      text-align: center;
      overflow: visible;
      padding: 3px;
    }

    .signature-box img {
      display: block;
      border: 0;
      outline: 0;
      max-width: 100%;
      max-height: 34px;
      width: auto;
      height: auto;
      margin: 0 auto;
      object-fit: contain;
    }

    .signature-line {
      display: block;
      margin-top: 4px;
      border-top: 1px solid #000;
      padding-top: 2px;
      text-align: center;
      font-size: 7px;
    }

    .h14 { height: 14px; }
    .h16 { height: 16px; }
    .h18 { height: 18px; }
    .h20 { height: 20px; }
    .h22 { height: 22px; }
    .h24 { height: 24px; }
    .h26 { height: 26px; }
    .h30 { height: 30px; min-height: 30px; }
    .h32 { height: 32px; }
    .h40 { height: 40px; }
    .h44 { height: 44px; min-height: 44px; }
    .h58 { height: 58px; min-height: 58px; }

    .nowrap { white-space: nowrap; }

    .header-outer {
      width: 100%;
      border: 1px solid #000;
    }

    .header-wrap {
      padding: 0;
      border: none;
    }

    .inner-noborder {
      border: none;
    }
  </style>
</head>
<body>
  <div class="sheet">
    <!-- Header Container (matches template) -->
    <table class="header-outer">
      <tr>
        <td class="header-wrap p0">
          <table style="border: none;">
            <colgroup>
              <col style="width: 70%;">
              <col style="width: 30%;">
            </colgroup>
            <!-- Header top: Logo + Company info (left) | Phone numbers (right) -->
            <tr style="height: 85px; min-height: 85px;">
              <td class="inner-noborder p0" style="vertical-align: top; padding: 4px;">
                <? 
                  // Use data.logoDataUri (new pattern) OR fallback to logoBase64 (legacy)
                  var logoSrc = data.logoDataUri || logoBase64 || '';
                ?>
                <div class="logo-box <?= debug ? 'debug-border' : '' ?>">
                  <? if (logoSrc && typeof logoSrc === 'string' && logoSrc.indexOf('data:image') === 0) { ?>
                    <img id="wcfLogo" src="<?!= logoSrc ?>" alt="">
                  <? } ?>
                </div>
                <? if (debug) { ?>
                  <div class="debug-text">
                    [LOGO] len=<?= (logoSrc || '').length ?> | <?= (logoSrc || '').substring(0, 40) ?>...
                  </div>
                <? } else if (!logoSrc || logoSrc.indexOf('data:image') !== 0) { ?>
                  <!-- Logo missing or invalid -->
                <? } ?>
                <div style="padding: 2px 4px; margin-top: 2px; font-size: 8px; line-height: 1.3;">
                  <div class="bold">Kawasaki Motors (Phils.) Corporation</div>
                  <div>Km. 24 East Service Rd., Cupang, Muntinlupa City</div>
                  <div class="bold">Email Address: KawasaWarranty@kmpc.com.ph</div>
                </div>
              </td>
              <td class="inner-noborder right tiny" style="padding: 2px 4px; vertical-align: top;">
                <div>KMPC Trunkline: 8842-3140 to 43</div>
                <div>Visayas&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local 5290</div>
                <div>Maintenance&nbsp;&nbsp;Loc. 5291</div>
              </td>
            </tr>
            <!-- Horizontal border row -->
            <tr style="height: 0;">
              <td colspan="2" style="padding: 0; border-left: none; border-right: none; border-bottom: none; border-top: 1px solid #000;"></td>
            </tr>
            <!-- Title band: Title (left) | Date/Job boxes (right) -->
            <tr>
              <td style="padding: 4px; vertical-align: middle; border-left: none; border-right: none; border-bottom: none; border-top: none;">
                <div class="bold" style="font-size: 16px; line-height: 1.2;">TECHNICAL SERVICE &amp; WARRANTY</div>
                <div class="bold" style="font-size: 9px;">(Warranty Claim Form)</div>
              </td>
              <td class="p0" style="vertical-align: middle; border-right: none; border-bottom: none; border-top: none; border-left: none;">
                <table style="border: none; width: 100%; table-layout: fixed;">
                  <colgroup>
                    <col style="width: 45%;">
                    <col style="width: 55%;">
                  </colgroup>
                  <tr style="height: 20px;">
                    <td class="box-label" style="border: 1px solid #000; border-bottom: none; padding: 2px 4px; font-size: 8px;">Prepared date:</td>
                    <td style="border: 1px solid #000; border-bottom: none; border-left: none; padding: 2px 4px; font-size: 8px;"><?= data.preparedDate || '' ?></td>
                  </tr>
                  <tr style="height: 20px;">
                    <td class="box-label" style="border: 1px solid #000; padding: 2px 4px; font-size: 8px;">Job Order No.:</td>
                    <td style="border: 1px solid #000; border-left: none; padding: 2px 4px; font-size: 8px;"><?= data.jobOrderNo || '' ?></td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>

    <table>
      <colgroup>
        <col style="width: 18%;">
        <col style="width: 32%;">
        <col style="width: 18%;">
        <col style="width: 32%;">
      </colgroup>
      <tr class="h18">
        <td class="box-label">Dealer's Name</td>
        <td><?= data.dealerName || '' ?></td>
        <td class="box-label">Phone number</td>
        <td><?= data.dealerPhone || '' ?></td>
      </tr>
      <tr class="h18">
        <td class="box-label">Dealer's Address</td>
        <td><?= data.dealerAddress || '' ?></td>
        <td class="box-label"></td>
        <td></td>
      </tr>
      <tr class="h18">
        <td class="box-label">Customer's Name</td>
        <td><?= data.customerName || '' ?></td>
        <td class="box-label">Phone number</td>
        <td><?= data.customerPhone || '' ?></td>
      </tr>
      <tr class="h18">
        <td class="box-label">Customer's Address</td>
        <td><?= data.customerAddress || '' ?></td>
        <td class="box-label"></td>
        <td></td>
      </tr>
      <tr class="h18">
        <td class="box-label">Model / Color</td>
        <td><?= (data.model || '') + (data.color ? ' / ' + data.color : '') ?></td>
        <td class="box-label">WRC No.</td>
        <td><?= data.wrcNo || '' ?></td>
      </tr>
      <tr class="h18">
        <td class="box-label">Frame No.</td>
        <td><?= data.frameNo || '' ?></td>
        <td class="box-label">Purchase Date</td>
        <td><?= data.purchaseDate || '' ?></td>
      </tr>
      <tr class="h18">
        <td class="box-label">Engine No.</td>
        <td><?= data.engineNo || '' ?></td>
        <td class="box-label">Failure Date</td>
        <td><?= data.failureDate || '' ?></td>
      </tr>
      <tr class="h18">
        <td class="box-label">MC Usage</td>
        <td>
          <span class="checkbox"><?= mcUsageChecked('SOLO') ?></span>SOLO
          &nbsp;
          <span class="checkbox"><?= mcUsageChecked('TRICYCLE') ?></span>Tricycle
          &nbsp;
          <span class="checkbox"><?= mcUsageChecked('OTHERS') ?></span>Others<?= (data.mcUsageOther ? ': ' + data.mcUsageOther : '') ?>
        </td>
        <td class="box-label">Reported Date</td>
        <td><?= data.reportedDate || '' ?></td>
      </tr>
      <tr class="h18">
        <td class="box-label">Kilometer Run</td>
        <td><?= data.kilometerRun || '' ?></td>
        <td class="box-label">Repair Date</td>
        <td><?= data.repairDate || '' ?></td>
      </tr>
    </table>

    <table>
      <tr class="h18"><td class="box-label">(A) PROBLEM / COMPLAINT REPORTED BY CUSTOMER:</td></tr>
      <tr class="h30"><td class="top"><?= data.problemComplaint || '' ?></td></tr>
      <tr class="h18"><td class="box-label">(B) PROBABLE CAUSE OF THE PROBLEM EVALUATED BY KSN:</td></tr>
      <tr class="h30"><td class="top"><?= data.probableCause || '' ?></td></tr>
      <tr class="h18"><td class="box-label">(C) CORRECTIVE ACTION FROM KSN:</td></tr>
      <tr class="h30"><td class="top"><?= data.correctiveAction || '' ?></td></tr>
      <tr class="h18"><td class="box-label">(D) SUGGESTION FOR IMPROVEMENT / REMARKS BY KSN:</td></tr>
      <tr class="h30"><td class="top"><?= data.suggestionRemarks || '' ?></td></tr>
      <tr class="h18"><td class="box-label">(E) PARTS RECOMMENDED FOR REPLACEMENT:</td></tr>
    </table>

    <table>
      <colgroup>
        <col style="width: 64%;">
        <col style="width: 36%;">
      </colgroup>
      <tr>
        <td class="p0 top">
          <table>
            <colgroup>
              <col style="width: 18%;">
              <col style="width: 28%;">
              <col style="width: 10%;">
              <col style="width: 11%;">
              <col style="width: 11%;">
              <col style="width: 11%;">
              <col style="width: 11%;">
            </colgroup>
            <tr class="h22">
              <td class="box-label" colspan="3">CAUSAL PART / MAIN DEFECTIVE PART</td>
              <td class="vertical" rowspan="2">KMPC H.O.</td>
              <td class="vertical" rowspan="2">KSC</td>
              <td class="vertical" rowspan="2">SP Dealer</td>
              <td class="vertical" rowspan="2">Warranty Stock</td>
            </tr>
            <tr class="h20">
              <td class="box-label center">PART NO</td>
              <td class="box-label center">PART NAME</td>
              <td class="box-label center">QTY</td>
            </tr>
            <tr class="h20">
              <td class="center"><?= data.causalPartNo || '' ?></td>
              <td><?= data.causalPartName || '' ?></td>
              <td class="center"><?= data.causalPartQty || '' ?></td>
              <? var causalSupply = String(data.partSupplyMethod || ''); ?>
              <td class="center"><?= (causalSupply.indexOf('KMPC') >= 0) ? '✓' : '' ?></td>
              <td class="center"><?= (causalSupply.indexOf('KSC') >= 0) ? '✓' : '' ?></td>
              <td class="center"><?= (causalSupply.indexOf('SP Dealer') >= 0) ? '✓' : '' ?></td>
              <td class="center"><?= (causalSupply.indexOf('Stock') >= 0) ? '✓' : '' ?></td>
            </tr>
            <tr class="h18">
              <td class="box-label center" colspan="3">AFFECTED PARTS</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <? if (affectedParts && affectedParts.length > 0) { ?>
              <? for (var i = 0; i < Math.min(affectedParts.length, 6); i++) { ?>
                <? var sm = String(affectedParts[i].supplyMethod || ''); ?>
                <tr class="h18">
                  <td><?= affectedParts[i].partNo || '' ?></td>
                  <td><?= affectedParts[i].partName || '' ?></td>
                  <td class="center"><?= affectedParts[i].qty || '' ?></td>
                  <td class="center"><?= (sm.indexOf('KMPC') >= 0) ? '✓' : '' ?></td>
                  <td class="center"><?= (sm.indexOf('KSC') >= 0) ? '✓' : '' ?></td>
                  <td class="center"><?= (sm.indexOf('SP Dealer') >= 0) ? '✓' : '' ?></td>
                  <td class="center"><?= (sm.indexOf('Stock') >= 0) ? '✓' : '' ?></td>
                </tr>
              <? } ?>
              <? for (var j = affectedParts.length; j < 6; j++) { ?>
                <tr class="h18"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
              <? } ?>
            <? } else { ?>
              <tr class="h18"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr class="h18"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr class="h18"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr class="h18"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr class="h18"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr class="h18"><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
            <? } ?>
          </table>
        </td>
        <td class="p0 top">
          <table>
            <tr class="h20">
              <td class="box-label">No of unit with the same problem, if any:</td>
            </tr>
            <tr class="h20">
              <td><?= data.unitsSameProblem || '' ?></td>
            </tr>
            <tr style="height: 110px; min-height: 110px;">
              <td class="p0" style="vertical-align: top;">
                <? 
                  // Use data.illustrationDataUri (new pattern) OR fallback to illustrationBase64 (legacy)
                  var illustrationSrc = data.illustrationDataUri || illustrationBase64 || '';
                ?>
                <div class="attach-placeholder <?= debug ? 'debug-border' : '' ?>">
                  <? if (illustrationSrc && typeof illustrationSrc === 'string' && illustrationSrc.indexOf('data:image') === 0) { ?>
                    <img id="wcfIllustration" src="<?!= illustrationSrc ?>" alt="">
                  <? } ?>
                </div>
                <? if (debug) { ?>
                  <div class="debug-text">
                    [ILL] len=<?= (illustrationSrc || '').length ?> | <?= (illustrationSrc || '').substring(0, 40) ?>...
                  </div>
                <? } ?>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>

    <table>
      <colgroup>
        <col style="width: 14%;">
        <col style="width: 86%;">
      </colgroup>
      <tr class="h18">
        <td class="box-label">DELIVER TO:</td>
        <td><?= data.deliverTo || '' ?></td>
      </tr>
      <tr class="h16">
        <td class="center tiny" colspan="2">For follow up, please call: KMPC Trunkline (Luzon) 8842-3140 loc. 5263 / 5364</td>
      </tr>
    </table>

    <table>
      <tr class="h18"><td class="center bold">FOR KSN USE ONLY</td></tr>
    </table>

    <table>
      <colgroup>
        <col style="width: 33.33%;">
        <col style="width: 33.33%;">
        <col style="width: 33.34%;">
      </colgroup>
      <tr class="h18">
        <td class="center box-label">Prepared by:</td>
        <td class="center box-label">Acknowledged by:</td>
        <td class="center box-label">Warranty Repair Conducted by:</td>
      </tr>
      <tr style="height: 52px; min-height: 52px;">
        <td class="top center" style="vertical-align: top; padding: 4px;">
          <? var prepSigSrc = data.preparedBySigDataUri || prepSigBase64 || ''; ?>
          <div class="signature-box <?= debug ? 'debug-border' : '' ?>">
            <? if (prepSigSrc && typeof prepSigSrc === 'string' && prepSigSrc.indexOf('data:image') === 0) { ?>
              <img id="sigPrepared" src="<?!= prepSigSrc ?>" alt="">
            <? } ?>
          </div>
          <? if (debug) { ?>
            <div class="debug-text">[PREP] len=<?= (prepSigSrc || '').length ?> | <?= (prepSigSrc || '').substring(0, 30) ?>...</div>
          <? } ?>
          <span class="signature-line"><?= data.preparedByName || '' ?></span>
        </td>
        <td class="top center" style="vertical-align: top; padding: 4px;">
          <? var ackSigSrc = data.ackSigDataUri || ackSigBase64 || ''; ?>
          <div class="signature-box <?= debug ? 'debug-border' : '' ?>">
            <? if (ackSigSrc && typeof ackSigSrc === 'string' && ackSigSrc.indexOf('data:image') === 0) { ?>
              <img id="sigAcknowledged" src="<?!= ackSigSrc ?>" alt="">
            <? } ?>
          </div>
          <? if (debug) { ?>
            <div class="debug-text">[ACK] len=<?= (ackSigSrc || '').length ?> | <?= (ackSigSrc || '').substring(0, 30) ?>...</div>
          <? } ?>
          <span class="signature-line"><?= data.acknowledgedByName || '' ?></span>
        </td>
        <td class="top center" style="vertical-align: top; padding: 4px;">
          <? var warSigSrc = data.warrantyRepairSigDataUri || warSigBase64 || ''; ?>
          <div class="signature-box <?= debug ? 'debug-border' : '' ?>">
            <? if (warSigSrc && typeof warSigSrc === 'string' && warSigSrc.indexOf('data:image') === 0) { ?>
              <img id="sigWarrantyRepair" src="<?!= warSigSrc ?>" alt="">
            <? } ?>
          </div>
          <? if (debug) { ?>
            <div class="debug-text">[WAR] len=<?= (warSigSrc || '').length ?> | <?= (warSigSrc || '').substring(0, 30) ?>...</div>
          <? } ?>
          <span class="signature-line"><?= data.warrantyRepairName || '' ?></span>
        </td>
      </tr>
    </table>

    <table>
      <tr class="h18"><td class="center bold">FOR KMPC USE ONLY</td></tr>
    </table>

    <table>
      <colgroup>
        <col style="width: 18%;">
        <col style="width: 26%;">
        <col style="width: 24%;">
        <col style="width: 16%;">
        <col style="width: 16%;">
      </colgroup>
      <tr class="h18">
        <td class="center box-label">Claim Judgment</td>
        <td class="center box-label">Reason(s) of Rejection</td>
        <td class="center box-label">Remarks</td>
        <td class="center box-label">Evaluated by:</td>
        <td class="center box-label">Noted by:</td>
      </tr>
      <tr class="h58">
        <td class="top">
          <div><span class="checkbox"><?= claimChecked('ACCEPTED') ?></span>Accepted</div>
          <div><span class="checkbox"><?= claimChecked('REJECTED') ?></span>Rejected</div>
          <div><span class="checkbox"><?= claimChecked('RETURNED') ?></span>Returned</div>
        </td>
        <td class="top">
          <div><span class="checkbox"><?= rejectReasonChecked('1') ?></span>Wrong frame / engine no.</div>
          <div><span class="checkbox"><?= rejectReasonChecked('2') ?></span>Warranty period expired</div>
          <div><span class="checkbox"><?= rejectReasonChecked('3') ?></span>Not covered by warranty</div>
          <div><span class="checkbox"><?= rejectReasonChecked('4') ?></span>Insufficient description</div>
          <div><span class="checkbox"><?= rejectReasonChecked('5') ?></span>Others: Pls. see remarks</div>
        </td>
        <td class="top"><?= data.claimRemarks || '' ?></td>
        <td class="top"><?= data.evaluatedBy || '' ?></td>
        <td class="top"><?= data.notedBy || '' ?></td>
      </tr>
      <tr class="h18">
        <td colspan="3"></td>
        <td class="box-label" colspan="2">TSWR No. &nbsp; <?= data.tswrNo || '' ?></td>
      </tr>
    </table>
  </div>
  <? if (debug) { ?>
  <!-- KNOWN-GOOD TEST: 1x1 red PNG (if this renders, the PDF renderer supports data URIs) -->
  <div style="position:absolute; bottom:0; right:0; width:10px; height:10px;">
    <img id="testKnownGood" src="<?!= 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==' ?>" alt="test" style="display:block; width:1px; height:1px;">
  </div>
  <? } ?>
</body>
</html>
